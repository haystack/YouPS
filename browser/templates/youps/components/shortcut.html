<div rule-id={{rule.id}} class="panel panel-primary">
	<div class="flex_container">
		<div class="flex_item_left"> 
			<i class="fas fa-3x fa-trash"></i> 
		</div>
	
		<div class="flex_item_right panel-heading">
			<h3 class="panel-title">
				<i style="float:left;" class="fas fa-2x fa-terminal"></i>
				<input type="text" style="float:left;border: none;background: none;border-bottom: 2px solid;" placeholder="My email rule" value="{{ rule.name }}" />
				<span class="preview-folder"></span>
			</h3>
			<span class="pull-right">
				<button class='btn-default btn-incoming-save'>Save</button>
				<i class="fas fa-chevron-up" style="display:none;"></i><i class="fas fa-chevron-down"></i>
			</span>
		</div>
	</div>
	<div class="panel-body">
		<div class="instruction-container">
			<span>You can run this shortcut using the <a href='/button'>shotcut window</a></span> <span class='email-instruction'>or forwarding the target messsage to {{rule.get_forward_addr}}
				<a class="glyphicon glyphicon-info-sign" id="popuplink{{rule.id}}" href="#inline"></a></span>

			<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" />
			
			<div id="inline" style="display:none;text-align:center;">
				If you want to quickly run one of your ruleÂ within your email client, you can simply forward a messsage to us! 
				Each rule has different email address assigned based on their rule name.
				If you have an argument, you can write an argument value on forwared body.   
				<img src="/static/images/shortcut_email.png" width=700/>
				<br><br>
				<p><a href="javascript:;" onclick="jQuery.fancybox.close();" style="background-color:#333;padding:5px 10px;color:#fff;border-radius:5px;text-decoration:none;">Close</a></p>
			</div>
			<!-- <script src="https://code.jquery.com/jquery-latest.min.js"></script> -->
			<br><br>	
			<ul id="arg-list-{{rule.id}}">
				{% for arg in args %}
					<li class="element">
						<input class="args-name" type="text" placeholder="name" value="{{arg.name}}" maxlength="100"/>:
						<select>
							{% with 'datetime string' as list %}
								{% for i in list.split %}
									{% if arg.type == i %}
										<option value="{{i}}" selected>{{i}}</option>
									{% else %}
										<option value="{{i}}">{{i}}</option>
									{% endif %}
								{% endfor %}
							{% endwith %}
						</select>
						<button class="btn">X</button>	
					</li>
				{% endfor %}
			</ul>
				
			<button id="add-{{rule.id}}">Add an argument</button>
	
			<script type="text/javascript">
				var add = document.getElementById('add');
	
				//adding a new element to the list
				$("#add-{{rule.id}}").click(function() {
					$("#arg-list-{{rule.id}}").append(`<li class="element">
						<input class="args-name" type="text" placeholder="name"/>:
						<select>
							<option value="datetime">Datetime</option>
							<option value="string">String</option>
								<!-- <option value="mercedes">Mercedes</option>
								<option value="audi">Audi</option> -->
						</select>
						<button class="btn">X</button>	
					</li>`);

					if ($("#arg-list-{{rule.id}} li").length > 1) {
						$("div[rule-id={{rule.id}}] .email-instruction").css("text-decoration", "line-through");
					}
				})
	
				$("#arg-list-{{rule.id}}").click(function(e) {
					if(e.target && e.target.nodeName == "BUTTON") {
						e.target.parentNode.remove();

						if ($("#arg-list-{{rule.id}} li").length <= 1) 
							$("div[rule-id={{rule.id}}] .email-instruction").css("text-decoration", "none");
					}
				})

				// Text validation of args name
				$('#arg-list-{{rule.id}}').on("keyup", 'input[type="text"]', function() {
					var raw_text =  $(this).val();
					var return_text = raw_text.replace(/[^a-zA-Z0-9_]/g,'');
					$(this).val(return_text);
				});

				$("#display").click(function(){
					$(this).hide();
					$(this).siblings("#edit").show().val($(this).text()).focus();
				});

				$("#edit").focusout(function(){
					$(this).hide();  $(this).siblings("#display").show().text($(this).val());
				});

				// init
				if ($("#arg-list-{{rule.id}} li").length > 1) {
						$("div[rule-id={{rule.id}}] .email-instruction").css("text-decoration", "line-through");
				}

				$(document).ready(function () {
					debugger;
					
				});
			</script>
			
		</div>
		<div class="editor-container">
			<textarea class="editor mode-editor" id="editor-{{mode.uid}}">
{{ rule.code }}
			</textarea>
		</div>
		<!-- Separte row for debugging -->
		<div class='debugger-container'>
			<button class='btn btn-default btn-debug-update'><i class="fas fa-sync"></i>Debug my code</button>

			<h2>Test suites</h2>
			<h4>Recent messages to test your rules (we will provide arbitrary value for specified arguments during compiling)</h4>
			<table class="example-suites table" style="width:100%">
				<thead>
					<tr>
					  <th>Sender</th>
					  <th>Message</th>
					  <th>Compiled Result</th>
					</tr>
				</thead>
				<tbody>
						
				</tbody>
			</table>
	</div>
	</div>
</div>